<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Use of GRASS interface • rgrass</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use of GRASS interface">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rgrass</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5-1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/coerce.html">Coercion between object formats</a></li>
    <li><a class="dropdown-item" href="../articles/use.html">Use of GRASS interface</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/osgeo/rgrass/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Use of GRASS interface</h1>
                        <h4 data-toc-skip class="author">Roger
Bivand</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/osgeo/rgrass/blob/main/vignettes/use.Rmd" class="external-link"><code>vignettes/use.Rmd</code></a></small>
      <div class="d-none name"><code>use.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The original R-GRASS interface <span class="citation">(Bivand 2000;
Neteler and Mitasova 2008)</span> was written mainly to permit R objects
represented as <strong>sp</strong> class objects to be moved to GRASS,
and GRASS objects to be moved to R for statistical analysis. From
<strong>spgrass6</strong> 0.6-3 (April 2009) following a fruitful
workshop at Queen’s University, Belfast, the interface was re-written to
use the <code>--interface-description</code> flag provided for each
GRASS command, also used by the Python interface to GRASS commands.
Command interface descriptions are parsed from XML and cached as R
objects for efficiency. The current version of the R-GRASS interface is
contained in this package, <strong>rgrass</strong>. In addition, an R
function <code><a href="../reference/initGRASS.html">initGRASS()</a></code> was written to permit GRASS to be
started from within GRASS to which we will return below.</p>
</div>
<div class="section level2">
<h2 id="starting-r-inside-grass">Starting R inside GRASS<a class="anchor" aria-label="anchor" href="#starting-r-inside-grass"></a>
</h2>
<p>When starting GRASS GIS from a terminal console (here GRASS 8.3.2),
one can continue in the GRASS terminal console, starting an interactive
R session from there (here R 4.3.3). Loading and attaching the R-GRASS
interface package <strong>rgrass</strong> in the R session, we see that
the current GRASS location is detected and reported:</p>
<pre><code>$ grass
Starting GRASS GIS...

          __________  ___   __________    _______________
         / ____/ __ \/   | / ___/ ___/   / ____/  _/ ___/
        / / __/ /_/ / /| | \__ \\_  \   / / __ / / \__ \
       / /_/ / _, _/ ___ |___/ /__/ /  / /_/ // / ___/ /
       \____/_/ |_/_/  |_/____/____/   \____/___//____/

Welcome to GRASS GIS 8.3.2
GRASS GIS homepage:                      https://grass.osgeo.org
This version running through:            Bash Shell (/bin/bash)
Help is available with the command:      g.manual -i
See the licence terms with:              g.version -c
See citation options with:               g.version -x
If required, restart the GUI with:       g.gui wxpython
When ready to quit enter:                exit

Launching &lt;wxpython&gt; GUI in the background, please wait...
GRASS nc_basic_spm_grass7/rsb:~ &gt; R

R version 4.3.3 (2024-02-29) -- "Angel Food Cake"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

...

&gt; library(rgrass)
GRASS GIS interface loaded with GRASS version: GRASS 8.3.2 (2024)
and location: nc_basic_spm_grass7</code></pre>
<p>Since <strong>rgrass</strong> <em>knows</em> the current location, we
can for example use <code><a href="../reference/execGRASS.html">execGRASS()</a></code> to list GRASS rasters in
the PERMANENT mapset in the standard North Carolina basic data set (<a href="https://grass.osgeo.org/sampledata/north_carolina/nc_basic_spm_grass7.zip" class="external-link uri">https://grass.osgeo.org/sampledata/north_carolina/nc_basic_spm_grass7.zip</a>):</p>
<pre><code>&gt; execGRASS("g.list", type="raster", mapset="PERMANENT")
basins
elevation
elevation_shade
geology
lakes
landuse
soils
&gt; q()
Save workspace image? [y/n/c]: n
GRASS nc_basic_spm_grass7/rsb:github-rsb &gt; exit
exit
Done.

Goodbye from GRASS GIS</code></pre>
<p>Leaving R returns us to the GRASS terminal console, which we can also
exit.</p>
<p>R can also be started within the GRASS GUI, by choosing the console
tab, and entering for example <code>rstudio</code>, or another R
graphical user interface. This screendump shows the same listing of
rasters in PERMANENT in <code>rstudio</code>:</p>
<p><img src="rstudio_in_GRASS.png" width="800"></p>
</div>
<div class="section level2">
<h2 id="starting-grass-inside-r">Starting GRASS inside R<a class="anchor" aria-label="anchor" href="#starting-grass-inside-r"></a>
</h2>
<p>From <strong>spgrass6</strong> 0.6-3, it has also been possible to
start a GRASS session from a running R session using the
<code><a href="../reference/initGRASS.html">initGRASS()</a></code> function. This is done by setting GRASS and
environment variables from the R session (<a href="https://grass.osgeo.org/grass-stable/manuals/variables.html" class="external-link uri">https://grass.osgeo.org/grass-stable/manuals/variables.html</a>).</p>
<p>It may be useful to set an environment variable to the value of
<code>GISBASE</code>, as shown for example in the GRASS terminal
console:</p>
<pre><code>GRASS nc_basic_spm_grass7/rsb:github-rsb &gt; echo $GISBASE
/home/rsb/topics/grass/g832/grass83</code></pre>
<p>Starting R with such a suitable environment variable set lets us
retrieve it later when needed. When loaded and attached,
<strong>rgrass</strong> reports that it seems that GRASS is not
running:</p>
<pre><code>$ GRASS_INSTALLATION=/home/rsb/topics/grass/g832/grass83 R

R version 4.3.3 (2024-02-29) -- "Angel Food Cake"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

...

&gt; library(rgrass)
GRASS GIS interface loaded with GRASS version: GRASS 8.3.2 (2024)
and location: nc_basic_spm_grass7</code></pre>
<p>On Windows, if GRASS was installed through the OSGeo4W installer, the
R session must be started in the OSGeo4W shell, including starting
RStudio. In using the OSGeo4W shell, found in the Windows left app
navbar (for example here in the QGIS app group, also found in the
OSGeo4W app group):</p>
<p><img src="OSGeo4W_QGIS_navbar.png" width="200"></p>
<p>note that the standard PATH to Rgui or RStudio apps is overwritten,
so the program name has to be entered with its full path, for example
<code>"C:\Program Files\R\R-4.3.3\bin\x64\Rgui.exe"</code> or
<code>"C:\Program Files\RStudio\rstudio.exe"</code> in quotes because of
the space. In addition, the working directory in not user-writeable, so
also needs to be changed when using Rgui, while RStudio itself changes
to the directory Windows treats as your home directory. First Rgui:</p>
<p><img src="OSGeo4W_Rgui.png" width="426"></p>
<p>and RStudio:</p>
<p><img src="OSGeo4W_rstudio.png" width="520"></p>
<p>In both cases, warnings can be seen on loading <code>terra</code>
which are not associated with RStudio, Rgui or R, but in this case were
caused by the OSGeo4W express installer not installing the correct
plugins for the GDAL version it installed by default. Using the OSGeo4W
custom installer from OSGeo4W Setup (also in the left app navbar), the
latest version of GDAL can be installed, resolving the non-critical
warnings.</p>
<p>If not started in the OSGeo4W shell, the non-standard placing of
files and of environment variables confuses the function and
<code>initGRASS</code> will exit with an error before confusion leads to
further errors. For further details, see <a href="https://github.com/osgeo/rgrass/issues/16" class="external-link uri">https://github.com/osgeo/rgrass/issues/16</a> and <a href="https://lists.osgeo.org/pipermail/grass-stats/2018-November/001800.html" class="external-link uri">https://lists.osgeo.org/pipermail/grass-stats/2018-November/001800.html</a>.</p>
<p>The same restriction applies to use of GRASS with QGIS Windows
standalone installations, which may be used with <code>initGRASS</code>
only if the R session is started from the OSGeo4W shell shipped as part
of the standalone installer (see <a href="https://github.com/osgeo/rgrass/issues/87" class="external-link uri">https://github.com/osgeo/rgrass/issues/87</a>).</p>
<p>The QGIS Windows standalone installer may be used to install GRASS
for <code>rgrass</code>, but if GRASS is to be run within R, again R or
RStudio must be started in the OSGeo4W shell installed this time by the
QGIS Windows standalone installer:</p>
<p><img src="OSGeo4W_QGIS_Rgui.png" width="426"></p>
<p>If not started from the required OSGeo4W shell, the function will
exit with an error before confusion leads to further errors.</p>
<p><img src="OSGeo4W_QGIS_rstudio.png" width="518"></p>
<p>Starting GRASS from R may use a temporary or an existing GRASS
<code>LOCATION</code>, as has already been demonstrated in the temporary
directory case in the OSGeo4W and QGIS standalone installer cases.</p>
<div class="section level3">
<h3 id="temporary-grass-location">Temporary GRASS location<a class="anchor" aria-label="anchor" href="#temporary-grass-location"></a>
</h3>
<p>If we don’t pass an existing location to <code><a href="../reference/initGRASS.html">initGRASS()</a></code>, a
temporary GRASS location will be created and set.</p>
<p>Here we’ll use a raster file provided with
<strong>terra</strong>:</p>
<pre><code>&gt; library(terra)
terra 1.7.71
&gt; f &lt;- system.file("ex/elev.tif", package="terra")
&gt; r &lt;- rast(f)</code></pre>
<p>The first argument to <code><a href="../reference/initGRASS.html">initGRASS()</a></code> is
<code>gisBase=</code>, which here we are passing the value of the
environment variable after checking that it is a directory. The second
argument is where to write the <code>GISRC</code> file. The third is a
template raster (here a <code>"SpatRaster"</code> object) from which to
clone the temporary location size, position, resolution and
projection:</p>
<pre><code>&gt; GRASS_INSTALLATION &lt;- Sys.getenv("GRASS_INSTALLATION")
&gt; file.info(GRASS_INSTALLATION)$isdir
[1] TRUE
&gt; loc &lt;- initGRASS(gisBase=GRASS_INSTALLATION, home=tempdir(), SG=r, override=TRUE)</code></pre>
<p>If the <code>gisBase</code> argument is missing,
<code><a href="../reference/initGRASS.html">initGRASS()</a></code> will do a minimal effort of guessing it.
Firstly, if a <code>GRASS_INSTALLATION</code> environment variable is
available, then its value will automatically be used for
<code>gisBase</code>. If not, then the system command
<code>grass --config path</code> will be tried to get the value of
<code>GISBASE</code> that corresponds to the GRASS installation in the
system PATH (if any).</p>
<p>As can be seen, <code><a href="../reference/initGRASS.html">initGRASS()</a></code> creates not only environment
and GRASS variables, but also many files in the location mapsets;
<code>g.gisenv</code> also shows details:</p>
<pre><code>&gt; list.files(file.path(loc$GISDBASE, loc$LOCATION_NAME), recursive=TRUE)
[1] "file28aaf6dc1c44c/WIND"          "file28aaf6dc1c44c/windows/input"
[3] "PERMANENT/DEFAULT_WIND"          "PERMANENT/PROJ_EPSG"            
[5] "PERMANENT/PROJ_INFO"             "PERMANENT/PROJ_SRID"            
[7] "PERMANENT/PROJ_UNITS"            "PERMANENT/PROJ_WKT"             
[9] "PERMANENT/WIND"                 
&gt; execGRASS("g.gisenv")
GISDBASE='/tmp/Rtmpe7QdVd';
LOCATION_NAME='file28aaf5be4b905';
MAPSET='file28aaf6dc1c44c';
GRASS_GUI='text';</code></pre>
<p>We may now write R objects to the temporary GRASS location for
manipulation and analysis, here calculating slope and aspect layers:</p>
<pre><code>&gt; write_RAST(r, vname="terra_elev")
Importing raster map &lt;terra_elev&gt;...
 100%
SpatRaster read into GRASS using r.in.gdal from file 
&gt; execGRASS("g.list", type="raster", mapset=loc$MAPSET)
terra_elev
&gt; execGRASS("r.slope.aspect", flags="overwrite", elevation="terra_elev", slope="slope", aspect="aspect")
 100%
Aspect raster map &lt;aspect&gt; complete
Slope raster map &lt;slope&gt; complete
&gt; u1 &lt;- read_RAST(c("terra_elev", "slope", "aspect"))
Checking GDAL data type and nodata value...
 100%
Using GDAL data type &lt;UInt16&gt;
Exporting raster data to RRASTER format...
 100%
r.out.gdal complete. File &lt;/tmp/RtmpLsAbI6/file29f4b33cd20f6.grd&gt; created.
Checking GDAL data type and nodata value...
 100%
Using GDAL data type &lt;Float32&gt;
Exporting raster data to RRASTER format...
 100%
r.out.gdal complete. File &lt;/tmp/RtmpLsAbI6/file29f4b2d2e045b.grd&gt; created.
Checking GDAL data type and nodata value...
 100%
Using GDAL data type &lt;Float32&gt;
Exporting raster data to RRASTER format...
 100%
r.out.gdal complete. File &lt;/tmp/RtmpLsAbI6/file29f4b52cab445.grd&gt; created.
&gt; u1
class       : SpatRaster 
dimensions  : 90, 95, 3  (nrow, ncol, nlyr)
resolution  : 0.008333326, 0.008333333  (x, y)
extent      : 5.741667, 6.533333, 49.44167, 50.19167  (xmin, xmax, ymin, ymax)
coord. ref. : lon/lat WGS 84 (EPSG:4326) 
sources     : file29f4b33cd20f6.grd  
              file29f4b2d2e045b.grd  
              file29f4b52cab445.grd  
names       :   terra_elev,        slope,       aspect 
min values  : 141.00000000,   0.01416342,   0.08974174 
max values  :   547.000000,     7.229438,   360.000000 </code></pre>
</div>
<div class="section level3">
<h3 id="existing-grass-location">Existing GRASS location<a class="anchor" aria-label="anchor" href="#existing-grass-location"></a>
</h3>
<p>Similarly, GRASS may be started in an R session with an existing
location by providing the <code>gisDbase=</code>, <code>location=</code>
and <code>mapset=</code> arguments with valid values:</p>
<pre><code>$ GRASS_INSTALLATION=/home/rsb/topics/grass/g832/grass83 R

R version 4.3.3 (2024-02-29) -- "Angel Food Cake"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

...

&gt; library(rgrass)
GRASS GIS interface loaded with GRASS version: (GRASS not running)
&gt; GRASS_INSTALLATION &lt;- Sys.getenv("GRASS_INSTALLATION")
&gt; loc &lt;- initGRASS(GRASS_INSTALLATION, home=tempdir(), gisDbase="/home/rsb/topics/grassdata", location="nc_basic_spm_grass7", mapset="rsb", override=TRUE)
&gt; execGRASS("g.gisenv")
GISDBASE='/home/rsb/topics/grassdata';
LOCATION_NAME='nc_basic_spm_grass7';
MAPSET='rsb';
GRASS_GUI='text';
&gt; execGRASS("g.list", type="raster", mapset="PERMANENT")
basins
elevation
elevation_shade
geology
lakes
landuse
soils</code></pre>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-bivand:00" class="csl-entry">
Bivand, R. S. 2000. <span>“Using the <span>R</span> Statistical Data
Analysis Language on <span>GRASS</span> 5.0 <span>GIS</span> Data Base
Files.”</span> <em>Computers and Geosciences</em> 26: 1043–52.
</div>
<div id="ref-neteler+mitasova:08" class="csl-entry">
Neteler, M., and H. Mitasova. 2008. <em>Open Source <span>GIS</span>: A
<span>GRASS</span> <span>GIS</span> Approach, Third Edition</em>. New
York: Springer.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Roger Bivand, Steven Pawley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
